<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyTrack - SMS Expense Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fa;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .transaction-income {
            border-left: 4px solid #10b981;
        }
        
        .transaction-expense {
            border-left: 4px solid #ef4444;
        }
        
        .tab-active {
            color: #6366f1;
            border-bottom: 3px solid #6366f1;
        }
        
        .floating-btn {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .permission-modal {
            z-index: 1000;
        }
        
        .sms-content {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .rule-modal {
            z-index: 1000;
        }
        
        .rule-form {
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .date-filter {
            transition: all 0.3s ease;
        }
        
        .date-filter.active {
            background-color: #6366f1;
            color: white;
        }
        
        .filter-modal {
            z-index: 1000;
        }
    </style>
</head>
<body class="relative pb-20">
    <!-- Header -->
    <header class="gradient-bg text-white p-6 rounded-b-3xl">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-2xl font-bold">MoneyTrack</h1>
                <p class="text-sm opacity-80">Track your money effortlessly</p>
            </div>
            <div class="flex space-x-2 items-center">
                <button id="filter-btn" class="bg-white bg-opacity-20 p-2 rounded-full flex items-center">
                    <i class="fas fa-filter mr-1"></i>
                    <span class="text-xs">Filter</span>
                </button>
                <button class="bg-white bg-opacity-20 p-2 rounded-full">
                    <i class="fas fa-bell"></i>
                </button>
                <button class="bg-white bg-opacity-20 p-2 rounded-full">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
        
        <div class="bg-white bg-opacity-20 p-4 rounded-2xl backdrop-blur-sm">
            <p class="text-sm mb-1">Current Balance</p>
            <h2 id="balance-amount" class="text-3xl font-bold mb-2">₹12,450.00</h2>
            <div class="flex justify-between text-sm">
                <div>
                    <p class="opacity-80">Income</p>
                    <p id="income-amount" class="font-medium">₹18,200.00</p>
                </div>
                <div class="text-right">
                    <p class="opacity-80">Expenses</p>
                    <p id="expense-amount" class="font-medium">₹5,750.00</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Filter Modal -->
    <div id="filter-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden filter-modal">
        <div class="bg-white rounded-2xl w-full max-w-md slide-in">
            <div class="p-4 border-b">
                <h3 class="font-medium text-lg">Filter Transactions</h3>
            </div>
            
            <div class="p-4">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Date Range</label>
                    <div class="flex space-x-2 mb-2">
                        <button id="filter-today" class="date-filter px-3 py-1 border rounded-lg text-sm">Today</button>
                        <button id="filter-week" class="date-filter px-3 py-1 border rounded-lg text-sm">This Week</button>
                        <button id="filter-month" class="date-filter px-3 py-1 border rounded-lg text-sm active">This Month</button>
                        <button id="filter-year" class="date-filter px-3 py-1 border rounded-lg text-sm">This Year</button>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-gray-700 mb-1 text-sm">From</label>
                            <input type="date" id="filter-from" class="w-full p-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-1 text-sm">To</label>
                            <input type="date" id="filter-to" class="w-full p-2 border rounded-lg">
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Transaction Type</label>
                    <div class="flex space-x-2">
                        <button id="filter-all" class="date-filter px-3 py-1 border rounded-lg text-sm active">All</button>
                        <button id="filter-income" class="date-filter px-3 py-1 border rounded-lg text-sm">Income</button>
                        <button id="filter-expense" class="date-filter px-3 py-1 border rounded-lg text-sm">Expense</button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Category</label>
                    <select id="filter-category" class="w-full p-2 border rounded-lg">
                        <option value="all">All Categories</option>
                        <option value="Food & Dining">Food & Dining</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Transportation">Transportation</option>
                        <option value="Salary">Salary</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            
            <div class="p-4 border-t flex justify-between">
                <button id="reset-filter-btn" class="px-4 py-2 border rounded-lg">Reset</button>
                <div class="flex space-x-2">
                    <button id="cancel-filter-btn" class="px-4 py-2 border rounded-lg">Cancel</button>
                    <button id="apply-filter-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="px-4 -mt-4">
        <!-- Tabs -->
        <div class="bg-white rounded-xl shadow-md p-1 mb-4 flex">
            <button id="transactions-tab" class="flex-1 py-3 font-medium text-center tab-active" data-tab="transactions">
                Transactions
            </button>
            <button id="categories-tab" class="flex-1 py-3 font-medium text-center text-gray-500" data-tab="categories">
                Categories
            </button>
            <button id="reports-tab" class="flex-1 py-3 font-medium text-center text-gray-500" data-tab="reports">
                Reports
            </button>
        </div>
        
        <!-- Transactions Tab Content -->
        <div id="transactions-content" class="tab-content active">
            <!-- SMS Import Section -->
            <div class="bg-indigo-50 rounded-xl p-4 mb-4 flex items-center justify-between">
                <div class="flex items-center">
                    <div class="bg-indigo-100 p-3 rounded-full mr-3">
                        <i class="fas fa-sms text-indigo-600"></i>
                    </div>
                    <div>
                        <h3 class="font-medium">Auto-import from SMS</h3>
                        <p id="sms-sync-status" class="text-sm text-gray-600">Last synced: 2 min ago</p>
                    </div>
                </div>
                <button id="import-sms-btn" class="bg-indigo-600 text-white p-2 rounded-full pulse">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            
            <!-- Filter Summary -->
            <div id="filter-summary" class="bg-white rounded-xl shadow-md p-3 mb-4 flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fas fa-filter text-indigo-600 mr-2"></i>
                    <p id="active-filter-text" class="text-sm">Showing: This Month</p>
                </div>
                <button id="clear-filter-btn" class="text-indigo-600 text-sm hidden">Clear</button>
            </div>
            
            <!-- Recent Transactions -->
            <div class="mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-medium">Recent Transactions</h3>
                    <button class="text-indigo-600 text-sm">See All</button>
                </div>
                
                <div id="transactions-list" class="space-y-2">
                    <!-- Transaction items will be added here by JavaScript -->
                </div>
            </div>
            
            <!-- SMS Parsing Rules -->
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-medium">SMS Parsing Rules</h3>
                    <button id="add-rule-btn" class="text-indigo-600">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>
                
                <div id="rules-list" class="space-y-3">
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium">HDFC Bank</p>
                            <p class="text-sm text-gray-600">Debit of ₹(.*) from a/c</p>
                        </div>
                        <button class="text-red-500">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium">Salary Credit</p>
                            <p class="text-sm text-gray-600">Credited.*?₹([0-9,]+)</p>
                        </div>
                        <button class="text-red-500">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Categories Tab Content -->
        <div id="categories-content" class="tab-content">
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <h3 class="font-medium mb-3">Expense Categories</h3>
                <div id="expense-categories" class="space-y-3">
                    <!-- Expense categories will be added here by JavaScript -->
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <h3 class="font-medium mb-3">Income Categories</h3>
                <div id="income-categories" class="space-y-3">
                    <!-- Income categories will be added here by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Reports Tab Content -->
        <div id="reports-content" class="tab-content">
            <!-- Time Period Selector -->
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <div class="flex justify-between items-center">
                    <button class="px-3 py-1 border rounded-lg text-sm">Week</button>
                    <button class="px-3 py-1 border rounded-lg bg-indigo-600 text-white text-sm">Month</button>
                    <button class="px-3 py-1 border rounded-lg text-sm">Quarter</button>
                    <button class="px-3 py-1 border rounded-lg text-sm">Year</button>
                </div>
            </div>
            
            <!-- Summary Cards -->
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="bg-white rounded-xl shadow-md p-4">
                    <p class="text-sm text-gray-600">Total Income</p>
                    <p id="report-income" class="text-xl font-bold text-green-600">₹18,200</p>
                    <p class="text-xs text-gray-500 mt-1">↑ 12% from last month</p>
                </div>
                <div class="bg-white rounded-xl shadow-md p-4">
                    <p class="text-sm text-gray-600">Total Expenses</p>
                    <p id="report-expense" class="text-xl font-bold text-red-600">₹5,750</p>
                    <p class="text-xs text-gray-500 mt-1">↓ 8% from last month</p>
                </div>
                <div class="bg-white rounded-xl shadow-md p-4">
                    <p class="text-sm text-gray-600">Savings Rate</p>
                    <p id="report-savings" class="text-xl font-bold text-indigo-600">31.5%</p>
                    <p class="text-xs text-gray-500 mt-1">↑ 5% from last month</p>
                </div>
                <div class="bg-white rounded-xl shadow-md p-4">
                    <p class="text-sm text-gray-600">Biggest Expense</p>
                    <p id="report-biggest" class="text-xl font-bold">Swiggy</p>
                    <p class="text-xs text-gray-500 mt-1">₹1,200 on Food</p>
                </div>
            </div>
            
            <!-- Expense Chart -->
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-medium">Expense Trend</h3>
                    <button class="text-indigo-600 text-sm">Details</button>
                </div>
                <canvas id="expenseChart" height="200"></canvas>
            </div>
            
            <!-- Income vs Expense Chart -->
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-medium">Income vs Expenses</h3>
                    <button class="text-indigo-600 text-sm">Details</button>
                </div>
                <canvas id="incomeExpenseChart" height="200"></canvas>
            </div>
            
            <!-- Category Breakdown -->
            <div class="bg-white rounded-xl shadow-md p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-medium">Expense Categories</h3>
                    <button class="text-indigo-600 text-sm">See All</button>
                </div>
                <canvas id="categoryChart" height="200"></canvas>
            </div>
            
            <!-- Spending Insights -->
            <div class="bg-white rounded-xl shadow-md p-4">
                <h3 class="font-medium mb-3">Spending Insights</h3>
                <div id="spending-insights" class="space-y-3">
                    <!-- Spending insights will be added here by JavaScript -->
                </div>
            </div>
        </div>
    </main>
    
    <!-- Add Transaction Floating Button -->
    <button id="add-transaction-btn" class="fixed bottom-6 right-6 bg-indigo-600 text-white p-4 rounded-full floating-btn">
        <i class="fas fa-plus text-xl"></i>
    </button>
    
    <!-- Add Transaction Modal -->
    <div id="transaction-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-2xl w-full max-w-md slide-in">
            <div class="p-4 border-b">
                <h3 class="font-medium text-lg">Add Transaction</h3>
            </div>
            
            <div class="p-4">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Type</label>
                    <div class="flex">
                        <button id="income-type-btn" class="flex-1 py-2 border rounded-l-lg bg-indigo-600 text-white">
                            Income
                        </button>
                        <button id="expense-type-btn" class="flex-1 py-2 border rounded-r-lg bg-white">
                            Expense
                        </button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Amount</label>
                    <input type="number" id="transaction-amount" class="w-full p-3 border rounded-lg" placeholder="₹0.00">
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Category</label>
                    <select id="transaction-category" class="w-full p-3 border rounded-lg">
                        <option value="">Select category</option>
                        <option value="Food & Dining">Food & Dining</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Transportation">Transportation</option>
                        <option value="Salary">Salary</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Description</label>
                    <input type="text" id="transaction-description" class="w-full p-3 border rounded-lg" placeholder="Optional">
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Date</label>
                    <input type="date" id="transaction-date" class="w-full p-3 border rounded-lg">
                </div>
            </div>
            
            <div class="p-4 border-t flex justify-end space-x-2">
                <button id="cancel-transaction-btn" class="px-4 py-2 border rounded-lg">Cancel</button>
                <button id="save-transaction-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg">Save</button>
            </div>
        </div>
    </div>
    
    <!-- SMS Import Modal -->
    <div id="sms-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-2xl w-full max-w-md slide-in">
            <div class="p-4 border-b">
                <h3 class="font-medium text-lg">Import Transactions from SMS</h3>
            </div>
            
            <div class="p-4">
                <div class="mb-4">
                    <p class="text-gray-700 mb-3">We found <span id="sms-count">0</span> new transactions in your SMS:</p>
                    
                    <div id="sms-content" class="sms-content space-y-2">
                        <!-- SMS content will be loaded here -->
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" id="auto-import-checkbox" class="mr-2" checked>
                        <span class="text-gray-700">Automatically import transactions from SMS</span>
                    </label>
                </div>
            </div>
            
            <div class="p-4 border-t flex justify-end space-x-2">
                <button id="cancel-sms-btn" class="px-4 py-2 border rounded-lg">Cancel</button>
                <button id="confirm-sms-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg">Import Selected</button>
            </div>
        </div>
    </div>
    
    <!-- SMS Permission Modal -->
    <div id="permission-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden permission-modal">
        <div class="bg-white rounded-2xl w-full max-w-md slide-in">
            <div class="p-4 border-b">
                <h3 class="font-medium text-lg">SMS Access Required</h3>
            </div>
            
            <div class="p-4">
                <p class="text-gray-700 mb-4">MoneyTrack needs permission to read your SMS messages to automatically detect and import transactions.</p>
                <p class="text-gray-700 mb-4">We only read financial SMS messages and never store or transmit your personal messages.</p>
                
                <div class="flex items-center mb-3 p-3 bg-blue-50 rounded-lg">
                    <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                    <p class="text-sm text-blue-700">On Android, you'll need to grant SMS permissions in your device settings.</p>
                </div>
            </div>
            
            <div class="p-4 border-t flex justify-end space-x-2">
                <button id="deny-permission-btn" class="px-4 py-2 border rounded-lg">Not Now</button>
                <button id="grant-permission-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg">Grant Permission</button>
            </div>
        </div>
    </div>
    
    <!-- Add Rule Modal -->
    <div id="rule-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden rule-modal">
        <div class="bg-white rounded-2xl w-full max-w-md slide-in">
            <div class="p-4 border-b">
                <h3 class="font-medium text-lg">Add SMS Parsing Rule</h3>
            </div>
            
            <div class="p-4 rule-form">
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Rule Name</label>
                    <input type="text" id="rule-name" class="w-full p-3 border rounded-lg" placeholder="e.g. HDFC Bank Debit">
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Sender (Optional)</label>
                    <input type="text" id="rule-sender" class="w-full p-3 border rounded-lg" placeholder="e.g. HDFCBANK">
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Pattern</label>
                    <input type="text" id="rule-pattern" class="w-full p-3 border rounded-lg" placeholder="e.g. Debit of ₹(.*) from a/c">
                    <p class="text-xs text-gray-500 mt-1">Use (.*) to capture the amount</p>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Transaction Type</label>
                    <select id="rule-type" class="w-full p-3 border rounded-lg">
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">Category</label>
                    <select id="rule-category" class="w-full p-3 border rounded-lg">
                        <option value="Food & Dining">Food & Dining</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Transportation">Transportation</option>
                        <option value="Salary">Salary</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            
            <div class="p-4 border-t flex justify-end space-x-2">
                <button id="cancel-rule-btn" class="px-4 py-2 border rounded-lg">Cancel</button>
                <button id="save-rule-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg">Save Rule</button>
            </div>
        </div>
    </div>
    
    <script>
        // Sample transaction data
        let transactions = [
            { id: 1, type: 'expense', amount: 1200, category: 'Food & Dining', description: 'Swiggy Order', date: '2023-06-15', icon: 'utensils' },
            { id: 2, type: 'income', amount: 25000, category: 'Salary', description: 'Monthly Salary', date: '2023-06-10', icon: 'money-bill-wave' },
            { id: 3, type: 'expense', amount: 350, category: 'Transportation', description: 'Uber Ride', date: '2023-06-08', icon: 'car' },
            { id: 4, type: 'expense', amount: 1200, category: 'Shopping', description: 'Amazon Purchase', date: '2023-06-05', icon: 'shopping-bag' },
            { id: 5, type: 'income', amount: 5000, category: 'Freelance', description: 'Project Payment', date: '2023-06-01', icon: 'laptop-code' },
            { id: 6, type: 'expense', amount: 2000, category: 'Food & Dining', description: 'Restaurant', date: '2023-05-28', icon: 'utensils' },
            { id: 7, type: 'expense', amount: 800, category: 'Transportation', description: 'Fuel', date: '2023-05-25', icon: 'car' },
            { id: 8, type: 'income', amount: 3000, category: 'Freelance', description: 'Consulting', date: '2023-05-20', icon: 'laptop-code' }
        ];
        
        // SMS parsing rules
        let smsParsingRules = [
            { id: 1, name: 'HDFC Bank', sender: 'HDFCBANK', pattern: 'Debit of ₹(.*) from a/c', type: 'expense', category: 'Other' },
            { id: 2, name: 'Salary Credit', sender: 'HDFCBANK', pattern: 'Credited.*?₹([0-9,]+)', type: 'income', category: 'Salary' }
        ];
        
        // SMS permissions state
        let hasSmsPermission = false;
        let autoImportEnabled = false;
        
        // Current transaction type (income/expense)
        let currentTransactionType = 'income';
        
        // Current filter settings
        let currentFilter = {
            dateRange: 'month', // 'day', 'week', 'month', 'year', or 'custom'
            fromDate: null,
            toDate: null,
            type: 'all', // 'all', 'income', 'expense'
            category: 'all' // 'all' or specific category
        };
        
        // Chart instances
        let expenseChart, incomeExpenseChart, categoryChart;
        
        // Sample SMS data (in a real app, this would come from the device's SMS inbox)
        const sampleSmsMessages = [
            {
                id: 'sms1',
                body: 'Debit of ₹1,200.00 from a/c XX1234 on 15-06-2023. Avl Bal: ₹24,567.89 - HDFC Bank',
                address: 'HDFCBANK',
                date: '2023-06-15T10:30:00'
            },
            {
                id: 'sms2',
                body: 'Credited ₹25,000.00 to your a/c XX1234 on 10-06-2023. Avl Bal: ₹25,567.89 - HDFC Bank',
                address: 'HDFCBANK',
                date: '2023-06-10T09:15:00'
            },
            {
                id: 'sms3',
                body: 'You have spent ₹350.00 at UBER*RIDE on 08-06-2023. Avl Bal: ₹567.89 - HDFC Bank',
                address: 'HDFCBANK',
                date: '2023-06-08T18:45:00'
            },
            {
                id: 'sms4',
                body: 'Your Amazon order #123-4567890 for ₹1,200.00 has been placed successfully.',
                address: 'AMAZON',
                date: '2023-06-05T14:20:00'
            },
            {
                id: 'sms5',
                body: 'Payment of ₹5,000.00 received from Client ABC for Project XYZ. Thank you!',
                address: 'PAYMENTS',
                date: '2023-06-01T11:10:00'
            }
        ];
        
        // Parse SMS message to extract transaction details
        function parseSmsToTransaction(sms) {
            const debitRegex = /Debit of ₹([0-9,.]+)/i;
            const creditRegex = /Credited ₹([0-9,.]+)/i;
            const spentRegex = /spent ₹([0-9,.]+)/i;
            const paymentRegex = /Payment of ₹([0-9,.]+)/i;
            const orderRegex = /order.*?₹([0-9,.]+)/i;
            
            let amount = 0;
            let type = '';
            let description = '';
            
            // Check for debit patterns
            const debitMatch = sms.body.match(debitRegex) || sms.body.match(spentRegex);
            if (debitMatch) {
                type = 'expense';
                amount = parseFloat(debitMatch[1].replace(/,/g, ''));
                description = sms.address.includes('HDFC') ? 'Bank Debit' : sms.address;
            }
            
            // Check for credit patterns
            const creditMatch = sms.body.match(creditRegex) || sms.body.match(paymentRegex);
            if (creditMatch && !type) {
                type = 'income';
                amount = parseFloat(creditMatch[1].replace(/,/g, ''));
                description = sms.address.includes('HDFC') ? 'Bank Credit' : 'Payment Received';
            }
            
            // Check for order patterns
            const orderMatch = sms.body.match(orderRegex);
            if (orderMatch && !type) {
                type = 'expense';
                amount = parseFloat(orderMatch[1].replace(/,/g, ''));
                description = sms.address + ' Order';
            }
            
            if (!type) return null;
            
            // Determine icon based on transaction type and description
            let icon = 'money-bill-wave';
            if (type === 'expense') {
                if (description.includes('Food') || description.includes('Swiggy') || description.includes('Zomato')) {
                    icon = 'utensils';
                } else if (description.includes('Uber') || description.includes('Ride') || description.includes('Transport')) {
                    icon = 'car';
                } else if (description.includes('Amazon') || description.includes('Flipkart') || description.includes('Shopping')) {
                    icon = 'shopping-bag';
                }
            }
            
            return {
                id: 't_' + sms.id,
                type,
                amount,
                category: type === 'income' ? 'Income' : 'Expense',
                description,
                date: sms.date.split('T')[0],
                icon,
                fromSms: true
            };
        }
        
        // Check for new transactions in SMS
        function checkForNewSmsTransactions() {
            if (!hasSmsPermission) return;
            
            // In a real app, this would read from the device's SMS inbox
            // For this demo, we're using sample data
            const potentialTransactions = sampleSmsMessages.map(sms => parseSmsToTransaction(sms))
                .filter(t => t !== null)
                .filter(t => !transactions.some(existing => existing.id === t.id));
            
            if (potentialTransactions.length > 0) {
                if (autoImportEnabled) {
                    // Auto-import if enabled
                    transactions = [...potentialTransactions, ...transactions];
                    renderTransactions();
                    updateSmsSyncStatus(`${potentialTransactions.length} new transactions imported`);
                } else {
                    // Show import modal if auto-import is disabled
                    showSmsImportModal(potentialTransactions);
                }
            } else {
                updateSmsSyncStatus('No new transactions found');
            }
        }
        
        // Show SMS import modal with detected transactions
        function showSmsImportModal(newTransactions) {
            const smsContent = document.getElementById('sms-content');
            const smsCount = document.getElementById('sms-count');
            
            smsContent.innerHTML = '';
            smsCount.textContent = newTransactions.length;
            
            newTransactions.forEach(t => {
                const smsEl = document.createElement('div');
                smsEl.className = 'flex items-center p-2 border rounded-lg';
                smsEl.innerHTML = `
                    <input type="checkbox" class="mr-3" checked data-id="${t.id}">
                    <div class="flex-1">
                        <p class="font-medium">₹${t.amount.toLocaleString()} - ${t.description}</p>
                        <p class="text-sm text-gray-600">${t.type === 'income' ? 'Credit' : 'Debit'} on ${t.date}</p>
                    </div>
                    <div class="ml-2 ${t.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                        <i class="fas fa-${t.icon}"></i>
                    </div>
                `;
                smsContent.appendChild(smsEl);
            });
            
            document.getElementById('sms-modal').classList.remove('hidden');
        }
        
        // Update SMS sync status text
        function updateSmsSyncStatus(text) {
            document.getElementById('sms-sync-status').textContent = text;
        }
        
        // Filter transactions based on current filter settings
        function filterTransactions() {
            let filtered = [...transactions];
            
            // Apply date filter
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            switch (currentFilter.dateRange) {
                case 'day':
                    filtered = filtered.filter(t => new Date(t.date).getTime() >= today.getTime());
                    break;
                case 'week':
                    const weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    filtered = filtered.filter(t => new Date(t.date).getTime() >= weekStart.getTime());
                    break;
                case 'month':
                    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    filtered = filtered.filter(t => new Date(t.date).getTime() >= monthStart.getTime());
                    break;
                case 'year':
                    const yearStart = new Date(today.getFullYear(), 0, 1);
                    filtered = filtered.filter(t => new Date(t.date).getTime() >= yearStart.getTime());
                    break;
                case 'custom':
                    if (currentFilter.fromDate) {
                        const fromDate = new Date(currentFilter.fromDate);
                        fromDate.setHours(0, 0, 0, 0);
                        filtered = filtered.filter(t => new Date(t.date).getTime() >= fromDate.getTime());
                    }
                    if (currentFilter.toDate) {
                        const toDate = new Date(currentFilter.toDate);
                        toDate.setHours(23, 59, 59, 999);
                        filtered = filtered.filter(t => new Date(t.date).getTime() <= toDate.getTime());
                    }
                    break;
            }
            
            // Apply type filter
            if (currentFilter.type !== 'all') {
                filtered = filtered.filter(t => t.type === currentFilter.type);
            }
            
            // Apply category filter
            if (currentFilter.category !== 'all') {
                filtered = filtered.filter(t => t.category === currentFilter.category);
            }
            
            return filtered;
        }
        
        // Calculate summary amounts based on filtered transactions
        function calculateSummary(filteredTransactions) {
            let income = 0;
            let expense = 0;
            
            filteredTransactions.forEach(t => {
                if (t.type === 'income') {
                    income += t.amount;
                } else {
                    expense += t.amount;
                }
            });
            
            return {
                income,
                expense,
                balance: income - expense
            };
        }
        
        // Update filter summary text
        function updateFilterSummary() {
            const summaryEl = document.getElementById('filter-summary');
            const clearBtn = document.getElementById('clear-filter-btn');
            const activeFilterText = document.getElementById('active-filter-text');
            
            let summaryText = '';
            
            switch (currentFilter.dateRange) {
                case 'day':
                    summaryText = 'Today';
                    break;
                case 'week':
                    summaryText = 'This Week';
                    break;
                case 'month':
                    summaryText = 'This Month';
                    break;
                case 'year':
                    summaryText = 'This Year';
                    break;
                case 'custom':
                    const fromDate = currentFilter.fromDate ? new Date(currentFilter.fromDate).toLocaleDateString() : '...';
                    const toDate = currentFilter.toDate ? new Date(currentFilter.toDate).toLocaleDateString() : '...';
                    summaryText = `${fromDate} to ${toDate}`;
                    break;
            }
            
            if (currentFilter.type !== 'all') {
                summaryText += ` • ${currentFilter.type.charAt(0).toUpperCase() + currentFilter.type.slice(1)}`;
            }
            
            if (currentFilter.category !== 'all') {
                summaryText += ` • ${currentFilter.category}`;
            }
            
            activeFilterText.textContent = `Showing: ${summaryText}`;
            
            // Show clear button if any filter is active (not default)
            if (currentFilter.dateRange !== 'month' || currentFilter.type !== 'all' || currentFilter.category !== 'all') {
                clearBtn.classList.remove('hidden');
                summaryEl.classList.add('bg-indigo-50');
            } else {
                clearBtn.classList.add('hidden');
                summaryEl.classList.remove('bg-indigo-50');
            }
        }
        
        // Render transactions with current filter applied
        function renderTransactions() {
            const container = document.getElementById('transactions-list');
            container.innerHTML = '';
            
            // Filter transactions
            const filteredTransactions = filterTransactions();
            
            // Calculate and update summary
            const summary = calculateSummary(filteredTransactions);
            document.getElementById('balance-amount').textContent = `₹${summary.balance.toLocaleString()}`;
            document.getElementById('income-amount').textContent = `₹${summary.income.toLocaleString()}`;
            document.getElementById('expense-amount').textContent = `₹${summary.expense.toLocaleString()}`;
            
            // Update reports tab with filtered data
            updateReportsTab(filteredTransactions);
            
            // Update categories tab with filtered data
            updateCategoriesTab(filteredTransactions);
            
            // Update filter summary text
            updateFilterSummary();
            
            // Sort by date (newest first)
            const sortedTransactions = [...filteredTransactions].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            if (sortedTransactions.length === 0) {
                container.innerHTML = `
                    <div class="bg-gray-50 rounded-xl p-4 text-center text-gray-500">
                        <i class="fas fa-inbox text-2xl mb-2"></i>
                        <p>No transactions found</p>
                    </div>
                `;
                return;
            }
            
            sortedTransactions.forEach(transaction => {
                const transactionEl = document.createElement('div');
                transactionEl.className = `bg-white rounded-xl p-3 flex items-center justify-between ${transaction.type === 'income' ? 'transaction-income' : 'transaction-expense'}`;
                
                transactionEl.innerHTML = `
                    <div class="flex items-center">
                        <div class="bg-${transaction.type === 'income' ? 'green' : 'red'}-100 p-2 rounded-full mr-3">
                            <i class="fas fa-${transaction.icon} text-${transaction.type === 'income' ? 'green' : 'red'}-600"></i>
                        </div>
                        <div>
                            <p class="font-medium">${transaction.description}</p>
                            <p class="text-sm text-gray-600">${transaction.category} • ${new Date(transaction.date).toLocaleDateString()}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-medium ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}">${transaction.type === 'income' ? '+' : '-'}₹${transaction.amount.toLocaleString()}</p>
                        ${transaction.fromSms ? '<p class="text-xs text-gray-400">SMS</p>' : ''}
                    </div>
                `;
                
                container.appendChild(transactionEl);
            });
        }
        
        // Update categories tab with filtered data
        function updateCategoriesTab(filteredTransactions) {
            const expenseCategoriesEl = document.getElementById('expense-categories');
            const incomeCategoriesEl = document.getElementById('income-categories');
            
            // Calculate expense categories
            const expenseCategories = {};
            const incomeCategories = {};
            
            filteredTransactions.forEach(t => {
                if (t.type === 'expense') {
                    if (!expenseCategories[t.category]) {
                        expenseCategories[t.category] = 0;
                    }
                    expenseCategories[t.category] += t.amount;
                } else {
                    if (!incomeCategories[t.category]) {
                        incomeCategories[t.category] = 0;
                    }
                    incomeCategories[t.category] += t.amount;
                }
            });
            
            // Calculate total expenses and income for percentages
            const totalExpenses = Object.values(expenseCategories).reduce((sum, amount) => sum + amount, 0);
            const totalIncome = Object.values(incomeCategories).reduce((sum, amount) => sum + amount, 0);
            
            // Render expense categories
            expenseCategoriesEl.innerHTML = '';
            Object.entries(expenseCategories).forEach(([category, amount]) => {
                const percentage = totalExpenses > 0 ? (amount / totalExpenses * 100).toFixed(1) : 0;
                
                const categoryEl = document.createElement('div');
                categoryEl.innerHTML = `
                    <div class="flex justify-between mb-1">
                        <span>${category}</span>
                        <span>₹${amount.toLocaleString()} (${percentage}%)</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill bg-red-500" style="width: ${percentage}%"></div>
                    </div>
                `;
                expenseCategoriesEl.appendChild(categoryEl);
            });
            
            if (Object.keys(expenseCategories).length === 0) {
                expenseCategoriesEl.innerHTML = `
                    <div class="bg-gray-50 rounded-xl p-4 text-center text-gray-500">
                        <i class="fas fa-inbox text-2xl mb-2"></i>
                        <p>No expense categories found</p>
                    </div>
                `;
            }
            
            // Render income categories
            incomeCategoriesEl.innerHTML = '';
            Object.entries(incomeCategories).forEach(([category, amount]) => {
                const percentage = totalIncome > 0 ? (amount / totalIncome * 100).toFixed(1) : 0;
                
                const categoryEl = document.createElement('div');
                categoryEl.innerHTML = `
                    <div class="flex justify-between mb-1">
                        <span>${category}</span>
                        <span>₹${amount.toLocaleString()} (${percentage}%)</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill bg-green-400" style="width: ${percentage}%"></div>
                    </div>
                `;
                incomeCategoriesEl.appendChild(categoryEl);
            });
            
            if (Object.keys(incomeCategories).length === 0) {
                incomeCategoriesEl.innerHTML = `
                    <div class="bg-gray-50 rounded-xl p-4 text-center text-gray-500">
                        <i class="fas fa-inbox text-2xl mb-2"></i>
                        <p>No income categories found</p>
                    </div>
                `;
            }
        }
        
        // Update reports tab with filtered data
        function updateReportsTab(filteredTransactions) {
            const summary = calculateSummary(filteredTransactions);
            
            // Update summary cards
            document.getElementById('report-income').textContent = `₹${summary.income.toLocaleString()}`;
            document.getElementById('report-expense').textContent = `₹${summary.expense.toLocaleString()}`;
            
            const savingsRate = summary.income > 0 ? ((summary.income - summary.expense) / summary.income * 100).toFixed(1) : 0;
            document.getElementById('report-savings').textContent = `${savingsRate}%`;
            
            // Find biggest expense
            const biggestExpense = filteredTransactions
                .filter(t => t.type === 'expense')
                .sort((a, b) => b.amount - a.amount)[0];
            
            if (biggestExpense) {
                document.getElementById('report-biggest').textContent = biggestExpense.description;
                document.querySelector('#report-biggest + p').textContent = 
                    `₹${biggestExpense.amount.toLocaleString()} on ${biggestExpense.category}`;
            } else {
                document.getElementById('report-biggest').textContent = 'None';
                document.querySelector('#report-biggest + p').textContent = 'No expenses found';
            }
            
            // Update spending insights
            const insightsEl = document.getElementById('spending-insights');
            insightsEl.innerHTML = '';
            
            // Simple spending insights based on filtered data
            if (filteredTransactions.length > 0) {
                const foodSpending = filteredTransactions
                    .filter(t => t.type === 'expense' && t.category === 'Food & Dining')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const transportSpending = filteredTransactions
                    .filter(t => t.type === 'expense' && t.category === 'Transportation')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                if (foodSpending > 0) {
                    const insightEl = document.createElement('div');
                    insightEl.className = 'flex items-start';
                    insightEl.innerHTML = `
                        <div class="bg-yellow-100 p-2 rounded-full mr-3">
                            <i class="fas fa-exclamation text-yellow-600"></i>
                        </div>
                        <div>
                            <p class="font-medium">Food spending</p>
                            <p class="text-sm text-gray-600">You've spent ₹${foodSpending.toLocaleString()} on food this period.</p>
                        </div>
                    `;
                    insightsEl.appendChild(insightEl);
                }
                
                if (transportSpending > 0) {
                    const insightEl = document.createElement('div');
                    insightEl.className = 'flex items-start';
                    insightEl.innerHTML = `
                        <div class="bg-blue-100 p-2 rounded-full mr-3">
                            <i class="fas fa-car text-blue-600"></i>
                        </div>
                        <div>
                            <p class="font-medium">Transportation spending</p>
                            <p class="text-sm text-gray-600">You've spent ₹${transportSpending.toLocaleString()} on transportation.</p>
                        </div>
                    `;
                    insightsEl.appendChild(insightEl);
                }
            }
            
            if (insightsEl.children.length === 0) {
                insightsEl.innerHTML = `
                    <div class="bg-gray-50 rounded-xl p-4 text-center text-gray-500">
                        <i class="fas fa-info-circle text-2xl mb-2"></i>
                        <p>No spending insights available</p>
                    </div>
                `;
            }
            
            // Update charts if they exist
            if (expenseChart && incomeExpenseChart && categoryChart) {
                updateCharts(filteredTransactions);
            }
        }
        
        // Update charts with filtered data
        function updateCharts(filteredTransactions) {
            // Group transactions by month for trend charts
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            const monthlyExpenses = [0, 0, 0, 0, 0, 0];
            const monthlyIncome = [0, 0, 0, 0, 0, 0];
            
            filteredTransactions.forEach(t => {
                const date = new Date(t.date);
                const month = date.getMonth(); // 0-11
                
                if (month >= 0 && month <= 5) { // Only show last 6 months for demo
                    if (t.type === 'expense') {
                        monthlyExpenses[month] += t.amount;
                    } else {
                        monthlyIncome[month] += t.amount;
                    }
                }
            });
            
            // Update expense trend chart
            expenseChart.data.datasets[0].data = monthlyExpenses;
            expenseChart.update();
            
            // Update income vs expense chart
            incomeExpenseChart.data.datasets[0].data = monthlyIncome;
            incomeExpenseChart.data.datasets[1].data = monthlyExpenses;
            incomeExpenseChart.update();
            
            // Update category breakdown chart
            const expenseCategories = {};
            filteredTransactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    if (!expenseCategories[t.category]) {
                        expenseCategories[t.category] = 0;
                    }
                    expenseCategories[t.category] += t.amount;
                });
            
            const categoryLabels = Object.keys(expenseCategories);
            const categoryData = Object.values(expenseCategories);
            
            categoryChart.data.labels = categoryLabels;
            categoryChart.data.datasets[0].data = categoryData;
            
            // Update colors based on number of categories
            const colors = ['#ef4444', '#3b82f6', '#f59e0b', '#10b981', '#8b5cf6', '#ec4899'];
            categoryChart.data.datasets[0].backgroundColor = categoryLabels.map((_, i) => colors[i % colors.length]);
            
            categoryChart.update();
        }
        
        // Render SMS parsing rules
        function renderSmsParsingRules() {
            const container = document.getElementById('rules-list');
            container.innerHTML = '';
            
            smsParsingRules.forEach(rule => {
                const ruleEl = document.createElement('div');
                ruleEl.className = 'flex items-center justify-between p-2 bg-gray-50 rounded-lg';
                ruleEl.innerHTML = `
                    <div>
                        <p class="font-medium">${rule.name}</p>
                        <p class="text-sm text-gray-600">${rule.pattern}</p>
                    </div>
                    <button class="text-red-500 delete-rule-btn" data-id="${rule.id}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                `;
                container.appendChild(ruleEl);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-rule-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const ruleId = parseInt(this.getAttribute('data-id'));
                    smsParsingRules = smsParsingRules.filter(rule => rule.id !== ruleId);
                    renderSmsParsingRules();
                });
            });
        }
        
        // Tab switching
        function switchTab(tabName) {
            // Update tab styling
            document.querySelectorAll('[data-tab]').forEach(tab => {
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('tab-active');
                    tab.classList.remove('text-gray-500');
                } else {
                    tab.classList.remove('tab-active');
                    tab.classList.add('text-gray-500');
                }
            });
            
            // Show/hide content
            document.querySelectorAll('.tab-content').forEach(content => {
                if (content.id === `${tabName}-content`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            // Initialize charts when reports tab is shown
            if (tabName === 'reports') {
                initializeCharts();
            }
        }
        
        document.querySelectorAll('[data-tab]').forEach(tab => {
            tab.addEventListener('click', () => switchTab(tab.dataset.tab));
        });
        
        // Initialize charts
        function initializeCharts() {
            // Expense Trend Chart
            const expenseCtx = document.getElementById('expenseChart').getContext('2d');
            expenseChart = new Chart(expenseCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Expenses',
                        data: [4500, 5200, 4800, 5500, 6000, 5750],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Income vs Expense Chart
            const incomeExpenseCtx = document.getElementById('incomeExpenseChart').getContext('2d');
            incomeExpenseChart = new Chart(incomeExpenseCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [
                        {
                            label: 'Income',
                            data: [15000, 16000, 17000, 17500, 18000, 18200],
                            backgroundColor: '#10b981',
                            borderRadius: 4
                        },
                        {
                            label: 'Expenses',
                            data: [4500, 5200, 4800, 5500, 6000, 5750],
                            backgroundColor: '#ef4444',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Category Breakdown Chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Food', 'Shopping', 'Transport', 'Entertainment', 'Other'],
                    datasets: [{
                        data: [2450, 1800, 1000, 500, 1000],
                        backgroundColor: [
                            '#ef4444',
                            '#3b82f6',
                            '#f59e0b',
                            '#10b981',
                            '#8b5cf6'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    },
                    cutout: '70%'
                }
            });
            
            // Update charts with filtered data
            updateCharts(filterTransactions());
        }
        
        // Transaction modal
        document.getElementById('add-transaction-btn').addEventListener('click', () => {
            // Reset form
            document.getElementById('transaction-amount').value = '';
            document.getElementById('transaction-category').value = '';
            document.getElementById('transaction-description').value = '';
            document.getElementById('transaction-date').value = new Date().toISOString().split('T')[0];
            
            // Set default type to income
            currentTransactionType = 'income';
            document.getElementById('income-type-btn').classList.add('bg-indigo-600', 'text-white');
            document.getElementById('expense-type-btn').classList.remove('bg-indigo-600', 'text-white');
            document.getElementById('expense-type-btn').classList.add('bg-white');
            
            document.getElementById('transaction-modal').classList.remove('hidden');
        });
        
        // Transaction type toggle
        document.getElementById('income-type-btn').addEventListener('click', function() {
            currentTransactionType = 'income';
            this.classList.add('bg-indigo-600', 'text-white');
            document.getElementById('expense-type-btn').classList.remove('bg-indigo-600', 'text-white');
            document.getElementById('expense-type-btn').classList.add('bg-white');
        });
        
        document.getElementById('expense-type-btn').addEventListener('click', function() {
            currentTransactionType = 'expense';
            this.classList.add('bg-indigo-600', 'text-white');
            document.getElementById('income-type-btn').classList.remove('bg-indigo-600', 'text-white');
            document.getElementById('income-type-btn').classList.add('bg-white');
        });
        
        // Cancel transaction
        document.getElementById('cancel-transaction-btn').addEventListener('click', function() {
            document.getElementById('transaction-modal').classList.add('hidden');
        });
        
        // Save transaction
        document.getElementById('save-transaction-btn').addEventListener('click', function() {
            const amount = parseFloat(document.getElementById('transaction-amount').value);
            const category = document.getElementById('transaction-category').value;
            const description = document.getElementById('transaction-description').value;
            const date = document.getElementById('transaction-date').value;
            
            if (!amount || isNaN(amount)) {
                alert('Please enter a valid amount');
                return;
            }
            
            if (!category) {
                alert('Please select a category');
                return;
            }
            
            // Determine icon based on category
            let icon = 'money-bill-wave';
            if (currentTransactionType === 'expense') {
                if (category.includes('Food')) {
                    icon = 'utensils';
                } else if (category.includes('Transport')) {
                    icon = 'car';
                } else if (category.includes('Shopping')) {
                    icon = 'shopping-bag';
                }
            }
            
            // Add new transaction
            const newTransaction = {
                id: Date.now(),
                type: currentTransactionType,
                amount,
                category,
                description: description || category,
                date,
                icon
            };
            
            transactions = [newTransaction, ...transactions];
            renderTransactions();
            
            document.getElementById('transaction-modal').classList.add('hidden');
        });
        
        // SMS modal
        document.getElementById('import-sms-btn').addEventListener('click', () => {
            if (!hasSmsPermission) {
                document.getElementById('permission-modal').classList.remove('hidden');
            } else {
                updateSmsSyncStatus('Checking for new transactions...');
                checkForNewSmsTransactions();
            }
        });
        
        document.getElementById('cancel-sms-btn').addEventListener('click', () => {
            document.getElementById('sms-modal').classList.add('hidden');
        });
        
        document.getElementById('confirm-sms-btn').addEventListener('click', () => {
            const selectedIds = Array.from(document.querySelectorAll('#sms-content input[type="checkbox"]:checked'))
                .map(checkbox => checkbox.dataset.id);
            
            // Get transactions from the sample data that match selected IDs
            const newTransactions = sampleSmsMessages
                .filter(sms => selectedIds.includes('t_' + sms.id))
                .map(sms => parseSmsToTransaction(sms))
                .filter(t => t !== null);
            
            // Add to transactions
            transactions = [...newTransactions, ...transactions];
            renderTransactions();
            
            document.getElementById('sms-modal').classList.add('hidden');
            updateSmsSyncStatus(`${newTransactions.length} transactions imported`);
        });
        
        // Permission modal
        document.getElementById('grant-permission-btn').addEventListener('click', () => {
            // In a real app, this would request SMS permissions
            // For this demo, we'll just simulate it
            hasSmsPermission = true;
            autoImportEnabled = document.getElementById('auto-import-checkbox').checked;
            
            document.getElementById('permission-modal').classList.add('hidden');
            document.querySelector('.pulse').classList.remove('pulse');
            
            updateSmsSyncStatus('Checking for new transactions...');
            checkForNewSmsTransactions();
        });
        
        document.getElementById('deny-permission-btn').addEventListener('click', () => {
            document.getElementById('permission-modal').classList.add('hidden');
        });
        
        // Add rule modal
        document.getElementById('add-rule-btn').addEventListener('click', () => {
            // Reset form
            document.getElementById('rule-name').value = '';
            document.getElementById('rule-sender').value = '';
            document.getElementById('rule-pattern').value = '';
            document.getElementById('rule-type').value = 'expense';
            document.getElementById('rule-category').value = 'Other';
            
            document.getElementById('rule-modal').classList.remove('hidden');
        });
        
        document.getElementById('cancel-rule-btn').addEventListener('click', () => {
            document.getElementById('rule-modal').classList.add('hidden');
        });
        
        document.getElementById('save-rule-btn').addEventListener('click', () => {
            const name = document.getElementById('rule-name').value.trim();
            const sender = document.getElementById('rule-sender').value.trim();
            const pattern = document.getElementById('rule-pattern').value.trim();
            const type = document.getElementById('rule-type').value;
            const category = document.getElementById('rule-category').value;
            
            if (!name || !pattern) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Add new rule
            const newRule = {
                id: Date.now(),
                name,
                sender: sender || null,
                pattern,
                type,
                category
            };
            
            smsParsingRules = [...smsParsingRules, newRule];
            renderSmsParsingRules();
            
            document.getElementById('rule-modal').classList.add('hidden');
        });
        
        // Filter modal
        document.getElementById('filter-btn').addEventListener('click', () => {
            // Set initial values in filter modal
            const today = new Date();
            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            
            document.getElementById('filter-from').value = currentFilter.fromDate || firstDayOfMonth.toISOString().split('T')[0];
            document.getElementById('filter-to').value = currentFilter.toDate || today.toISOString().split('T')[0];
            document.getElementById('filter-category').value = currentFilter.category;
            
            // Set active date range button
            document.querySelectorAll('.date-filter').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter-${currentFilter.dateRange}`)?.classList.add('active');
            document.getElementById(`filter-${currentFilter.type}`)?.classList.add('active');
            
            document.getElementById('filter-modal').classList.remove('hidden');
        });
        
        document.getElementById('cancel-filter-btn').addEventListener('click', () => {
            document.getElementById('filter-modal').classList.add('hidden');
        });
        
        document.getElementById('reset-filter-btn').addEventListener('click', () => {
            // Reset to default filter
            currentFilter = {
                dateRange: 'month',
                fromDate: null,
                toDate: null,
                type: 'all',
                category: 'all'
            };
            
            renderTransactions();
            document.getElementById('filter-modal').classList.add('hidden');
        });
        
        document.getElementById('apply-filter-btn').addEventListener('click', () => {
            // Get selected date range
            const dateRangeBtn = document.querySelector('.date-filter.active[data-date-range]');
            currentFilter.dateRange = dateRangeBtn ? dateRangeBtn.id.replace('filter-', '') : 'month';
            
            // Get from/to dates if custom range
            if (currentFilter.dateRange === 'custom') {
                currentFilter.fromDate = document.getElementById('filter-from').value;
                currentFilter.toDate = document.getElementById('filter-to').value;
            } else {
                currentFilter.fromDate = null;
                currentFilter.toDate = null;
            }
            
            // Get transaction type
            const typeBtn = document.querySelector('.date-filter.active[data-filter-type]');
            currentFilter.type = typeBtn ? typeBtn.id.replace('filter-', '') : 'all';
            
            // Get category
            currentFilter.category = document.getElementById('filter-category').value;
            
            // Save filter to localStorage
            localStorage.setItem('moneyTrackFilter', JSON.stringify(currentFilter));
            
            renderTransactions();
            document.getElementById('filter-modal').classList.add('hidden');
        });
        
        document.getElementById('clear-filter-btn').addEventListener('click', () => {
            // Reset to default filter
            currentFilter = {
                dateRange: 'month',
                fromDate: null,
                toDate: null,
                type: 'all',
                category: 'all'
            };
            
            // Save filter to localStorage
            localStorage.setItem('moneyTrackFilter', JSON.stringify(currentFilter));
            
            renderTransactions();
        });
        
        // Date range button click handlers
        document.querySelectorAll('[data-date-range]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-date-range]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Transaction type button click handlers
        document.querySelectorAll('[data-filter-type]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-filter-type]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved filter from localStorage if available
            const savedFilter = localStorage.getItem('moneyTrackFilter');
            if (savedFilter) {
                currentFilter = JSON.parse(savedFilter);
            }
            
            renderTransactions();
            renderSmsParsingRules();
            
            // Set default date in transaction form
            document.getElementById('transaction-date').value = new Date().toISOString().split('T')[0];
            
            // Check for SMS permission (simulated)
            setTimeout(() => {
                if (!hasSmsPermission) {
                    document.getElementById('permission-modal').classList.remove('hidden');
                }
            }, 1000);
            
            // Simulate periodic SMS checking (every 30 seconds)
            setInterval(() => {
                if (hasSmsPermission && autoImportEnabled) {
                    checkForNewSmsTransactions();
                }
            }, 30000);
        });
    </script>
</body>
</html>